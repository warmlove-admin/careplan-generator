<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>照顧計畫敘述產生器（多段落 / 可編輯）</title>
  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --bg:#f8fafc; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"; margin: 0; background: var(--bg); color:#0b1220;}
    .container { max-width: 1200px; margin: 0 auto; padding: 24px;}
    h1 { font-size: 24px; margin: 0 0 12px; }
    p.lead { color:#475569; margin: 0 0 16px;}
    .grid { display: grid; grid-template-columns: 360px 1fr; gap: 16px; }
    @media(max-width: 980px){ .grid{ grid-template-columns: 1fr; } }
    .card { background: white; border: 1px solid var(--line); border-radius: 14px; box-shadow: 0 1px 0 rgba(0,0,0,0.03); }
    .card h2 { font-size: 18px; padding: 16px 16px 0; margin: 0;}
    .card .body { padding: 16px; }
    .row { margin-bottom: 12px; }
    label.block { display:block; font-size: 14px; color:#334155; margin-bottom: 6px; }
    input[type="date"], input[type="text"], textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border:1px solid #cbd5e1; background:#fff; box-sizing: border-box;}
    textarea { min-height: 180px; font-size: 15px; }
    .chips { display:flex; gap:8px; flex-wrap: wrap; }
    .chip { display:inline-flex; align-items:center; gap:8px; border:1px solid #cbd5e1; background:#f8fafc; padding:8px 10px; border-radius:12px; cursor:pointer; user-select:none; }
    .chip input { transform: scale(1.1); }
    .seg { display:flex; gap:8px; flex-wrap: wrap; }
    .seg input { display:none; }
    .seg label { border:1px solid #cbd5e1; padding:8px 12px; border-radius:12px; cursor:pointer; background:#f8fafc; }
    .seg input:checked + label { background:var(--ink); color:white; border-color:var(--ink); }
    .small { font-size: 12px; color:var(--muted); }
    .flex { display:flex; align-items:center; gap:10px; }
    .btn { padding:10px 14px; border-radius:10px; border:1px solid var(--ink); background:var(--ink); color:#fff; cursor:pointer; }
    .btn.secondary { background:#f1f5f9; color:var(--ink); border-color:#cbd5e1; }
    .btn.ghost { background:transparent; color:var(--ink); border-color:#cbd5e1; }
    .btn.row { width:100%; }
    .muted { color:var(--muted); font-size:12px; }
    .sectitle { font-weight:600; font-size:14px; margin-top:10px; margin-bottom:6px;}
    .section-list label { display:flex; align-items:center; gap:8px; margin:6px 0; }
    .divider { height:1px; background:var(--line); margin:12px 0; }
    details { border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff; }
    details + details { margin-top:10px; }
    summary { font-weight:600; cursor:pointer; outline:none; }
    .twocol { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media(max-width:760px){ .twocol{ grid-template-columns:1fr; } }

    /* sticky 右側 */
    .right-sticky { position: sticky; top: 12px; align-self: start; }
    @media(max-width:980px){ .right-sticky{ top: 8px; } }

    /* 段落切換按鈕 */
    .tabs { display:flex; flex-wrap: wrap; gap:8px; padding:0 16px 12px; }
    .tab { border:1px solid #cbd5e1; background:#f8fafc; color:#0b1220; padding:8px 10px; border-radius:10px; cursor:pointer; }
    .tab.active { background:var(--ink); color:#fff; border-color:var(--ink); }

    textarea#editor { min-height: 320px; border-radius:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>照顧計畫敘述產生器（多段落 / 可編輯）</h1>
    <p class="lead">左側勾選或輸入會自動更新到右側文字（段落切換於上方）。你可隨時手動微調，每段的手改內容會保留。</p>

    <div class="grid">
      <!-- 左側 -->
      <div class="card">
        <h2>段落選擇與輸入</h2>
        <div class="body">
          <div class="sectitle">要生成的段落（可複選）</div>
          <div class="section-list">
            <label><input type="checkbox" id="sec1" checked> 1. 訪視摘要</label>
            <label><input type="checkbox" id="sec2" checked> 2. 需求與問題評估</label>
            <label><input type="checkbox" id="sec3"> 3. 照顧目標</label>
            <label><input type="checkbox" id="sec4"> 4. 照顧計畫</label>
            <label><input type="checkbox" id="sec5"> 5. 風險與衛教</label>
            <label><input type="checkbox" id="sec6"> 6. 追蹤與回訪</label>
          </div>
          <div class="divider"></div>

          <!-- 第1段 -->
          <details open>
            <summary>（第1段）訪視摘要</summary>

            <div class="row">
              <label class="block">訪視日期（西元）</label>
              <input id="visitDate" type="date" />
              <div class="muted">會轉民國格式，例如 2025-08-12 → 114/08/12</div>
            </div>

            <div class="row">
              <label class="block">受訪對象（可複選）</label>
              <div id="parties" class="chips"></div>
            </div>

            <div class="row">
              <label class="block">意識</label>
              <div class="seg" id="awareness"></div>
            </div>

            <div class="row">
              <label class="block">聽力（可複選）</label>
              <div id="hearing" class="chips"></div>
            </div>

            <div class="row">
              <label class="block">認知功能</label>
              <div class="seg" id="cognition"></div>
            </div>

            <div class="row">
              <label class="block">是否能切題對談</label>
              <div class="seg" id="onTopic"></div>
            </div>

            <div class="row">
              <label class="block">疾病史</label>
              <div class="flex">
                <input id="noDisease" type="checkbox"/>
                <label for="noDisease" class="small">無疾病史</label>
              </div>
              <div id="diseases" class="chips" style="margin-top:6px;"></div>
            </div>

            <div class="row">
              <label class="block">追蹤醫院（可複選）</label>
              <div id="hospitals" class="chips"></div>
              <div class="small">未勾選疾病史時可留白。</div>
            </div>

            <div class="row">
              <label class="block">步態</label>
              <div class="seg" id="gait"></div>
            </div>

            <div class="row">
              <label class="block">是否使用輔具</label>
              <div class="flex">
                <input id="useAid" type="checkbox"/>
                <label for="useAid" class="small"><span id="useAidLabel">未使用</span></label>
              </div>
              <div id="aids" class="chips" style="margin-top:6px; display:none;"></div>
            </div>

            <div class="row">
              <label class="block">日常生活自理程度</label>
              <div class="seg" id="adl"></div>
            </div>

            <div class="divider"></div>
            <div class="row">
              <label class="block">同住成員（複選 → 第1段第二小段）</label>
              <div id="cohab" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">住所類型（複選）</label>
              <div id="housing" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">外出能力（複選）</label>
              <div id="outdoor" class="chips"></div>
              <div class="small">「困難」會輸出：外出困難，需大量協助</div>
            </div>
            <div class="row">
              <label class="block">照顧支持（複選）</label>
              <div id="support" class="chips"></div>
            </div>
          </details>

          <!-- 第2段 -->
          <details>
            <summary>（第2段）需求與問題評估</summary>
            <div class="row">
              <label class="block">勾選重點（可複選）</label>
              <div id="needs" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">補充說明</label>
              <textarea id="needsNote" placeholder="例：近期跌倒兩次，夜間如廁不便；家屬照顧壓力增加等。"></textarea>
            </div>
          </details>

          <!-- 第3段 -->
          <details>
            <summary>（第3段）照顧目標</summary>
            <div class="row">
              <label class="block">目標（可複選）</label>
              <div id="goals" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">補充/量化指標</label>
              <textarea id="goalsNote" placeholder="例：一週內學會助行器正確使用；一個月內跌倒事件為 0。 "></textarea>
            </div>
          </details>

          <!-- 第4段 -->
          <details>
            <summary>（第4段）照顧計畫</summary>
            <div class="row">
              <label class="block">服務項目（可複選）</label>
              <div id="services" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">時程/頻率</label>
              <input id="serviceSched" type="text" placeholder="例：每週二四居服 2hr；每月一次護理評估"/>
            </div>
            <div class="row">
              <label class="block">補充說明</label>
              <textarea id="servicesNote" placeholder="例：同步申請輔具補助；安排交通接送門診。"></textarea>
            </div>
          </details>

          <!-- 第5段 -->
          <details>
            <summary>（第5段）風險與衛教</summary>
            <div class="row">
              <label class="block">衛教主題（可複選）</label>
              <div id="education" class="chips"></div>
            </div>
            <div class="row">
              <label class="block">衛教重點/注意事項</label>
              <textarea id="educationNote" placeholder="例：地面防滑、夜間照明、正確用藥與回診提醒等。"></textarea>
            </div>
          </details>

          <!-- 第6段 -->
          <details>
            <summary>（第6段）追蹤與回訪</summary>
            <div class="twocol">
              <div class="row">
                <label class="block">下次追蹤日期（西元）</label>
                <input id="nextDate" type="date"/>
              </div>
              <div class="row">
                <label class="block">追蹤方式</label>
                <div class="seg" id="followType"></div>
              </div>
            </div>
            <div class="row">
              <label class="block">負責人/單位</label>
              <input id="followOwner" type="text" placeholder="例：個管員王小華 / 中心名"/>
            </div>
            <div class="row">
              <label class="block">備註</label>
              <textarea id="followNote" placeholder="其它安排或注意事項..."></textarea>
            </div>
          </details>

        </div>
      </div>

      <!-- 右側：分段切換 + 編輯 -->
      <div class="card right-sticky">
        <h2 style="display:flex;justify-content:space-between;align-items:center;">
          <span>自動產生敘述（可編輯）</span>
          <span class="flex">
            <button id="clearThis" class="btn secondary">清空本段</button>
            <button id="copyBtn" class="btn">複製全部</button>
          </span>
        </h2>
        <div class="tabs" id="tabs">
          <button class="tab active" data-sec="1">訪視摘要</button>
          <button class="tab" data-sec="2">需求與問題評估</button>
          <button class="tab" data-sec="3">照顧目標</button>
          <button class="tab" data-sec="4">照顧計畫</button>
          <button class="tab" data-sec="5">風險與衛教</button>
          <button class="tab" data-sec="6">追蹤與回訪</button>
        </div>
        <div class="body">
          <textarea id="editor" placeholder="這裡顯示目前選取的段落文字；切換上方按鈕可改編輯其他段落。"></textarea>
          <div class="muted">左側變更會自動覆寫「尚未手動修改」的段落；你在此輸入後，該段即視為已手動修改，不會被自動覆蓋。</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ===== 常數選項 ===== */
    const NAMES = {1:"訪視摘要",2:"需求與問題評估",3:"照顧目標",4:"照顧計畫",5:"風險與衛教",6:"追蹤與回訪"};

    const VISIT_PARTIES = ["個案","案長女","案次女","配偶","主要照顧者"];
    const AWARENESS = ["清楚","模糊"];
    const HEARING   = ["正常","右耳重聽","左耳重聽","雙耳重聽"];
    const COGNITION = ["正常","欠佳"];
    const ON_TOPIC  = ["能夠","無法"];
    const DISEASES  = ["高血壓","糖尿病","中風","心臟病","腎臟病"];
    const HOSPITALS = ["汐止國泰","內湖三總","忠孝醫院"];
    const GAIT      = ["穩健","不穩"];
    const WALK_AID  = ["助行器","拐杖","輪椅"];
    const ADL_LEVEL = ["可自理","部分需協助（如廁/沐浴）","完全無法自理"];

    const COHAB     = ["獨居","案妻","案子","案女","外看"];
    const HOUSING   = ["公寓","電梯大樓"];
    const OUTDOOR   = ["獨立","部份協助","困難","爬梯機"];
    const OUTDOOR_MAP = {
      "獨立":"可自行外出",
      "部份協助":"他人陪同下可外出",
      "困難":"外出困難，需大量協助",
      "爬梯機":"外出須使用爬梯機"
    };
    const SUPPORT   = ["極佳","尚佳","薄弱"];

    const NEEDS     = ["醫療追蹤/用藥管理","ADL/IADL 自理能力","認知/情緒","環境安全","營養/吞嚥","經濟資源","照顧負荷","交通接送","其他"];
    const GOALS     = ["維持生活自理","改善步態穩定","提升居家安全","增加衛教遵從","強化家庭支持","改善營養狀況"];
    const SERVICES  = ["居家服務","居家護理","居家復健","日照中心","送餐服務","交通接送","個案管理/家訪","轉介社工","申請輔具","居家環境改善"];
    const EDU_TOPICS= ["跌倒預防","用藥安全","壓瘡預防","吞嚥與營養","運動復健","緊急應變/聯絡流程"];
    const FOLLOW_TYPES = ["電話追蹤","到宅訪視","門診陪同"];

    /* ===== 工具 ===== */
    const $ = (id)=>document.getElementById(id);
    function toROC(dateStr){
      if(!dateStr) return "____/__/__";
      const d = new Date(dateStr);
      if(isNaN(d)) return "____/__/__";
      const y = d.getFullYear() - 1911;
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}/${m}/${day}`;
    }
    function renderChips(containerId, list, stateSet){
      const box = $(containerId);
      box.innerHTML = "";
      list.forEach(txt => {
        const label = document.createElement("label");
        label.className = "chip";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = stateSet.has(txt);
        input.addEventListener("change", () => {
          if(input.checked) stateSet.add(txt); else stateSet.delete(txt);
          maybeAuto(1); // 大多數 chips 影響第1段
          if(containerId==="needs") maybeAuto(2);
          if(containerId==="goals") maybeAuto(3);
          if(containerId==="services") maybeAuto(4);
          if(containerId==="education") maybeAuto(5);
        });
        label.appendChild(input);
        label.appendChild(document.createTextNode(txt));
        box.appendChild(label);
      });
    }
    function renderSegment(containerId, list, state){
      const box = $(containerId);
      box.innerHTML = "";
      list.forEach(txt => {
        const id = containerId+"-"+txt;
        const input = document.createElement("input");
        input.type = "radio"; input.name = containerId; input.id = id;
        input.checked = (state.value===txt);
        input.addEventListener("change", () => { state.value = txt; maybeAuto(1); if(containerId==="followType") maybeAuto(6); });
        const label = document.createElement("label");
        label.htmlFor = id; label.textContent = txt;
        box.appendChild(input); box.appendChild(label);
      });
    }
    function chipsToList(set){ return set.size? Array.from(set).join("、") : ""; }

    /* ===== 狀態 ===== */
    const state = {
      visitDate: "",
      parties: new Set(["個案"]),
      awareness: {value:"清楚"},
      hearing: new Set(["正常"]),
      cognition: {value:"正常"},
      onTopic:   {value:"能夠"},
      noDisease: false,
      diseases:  new Set(),
      hospitals: new Set(),
      gait:      {value:"穩健"},
      useAid:    false,
      aids:      new Set(),
      adl:       {value:"可自理"},
      cohab:     new Set(),
      housing:   new Set(),
      outdoor:   new Set(),
      support:   new Set(),

      needs:     new Set(),
      needsNote: "",
      goals:     new Set(),
      goalsNote: "",
      services:  new Set(),
      serviceSched: "",
      servicesNote:"",

      education: new Set(),
      educationNote:"",

      nextDate: "",
      followType:{value:"電話追蹤"},
      followOwner:"",
      followNote:"",
    };

    /* ===== 初始化 UI ===== */
    $("visitDate").addEventListener("input", e => { state.visitDate = e.target.value; maybeAuto(1); });

    renderChips("parties", VISIT_PARTIES, state.parties);
    renderSegment("awareness", AWARENESS, state.awareness);
    renderChips("hearing", HEARING, state.hearing);
    renderSegment("cognition", COGNITION, state.cognition);
    renderSegment("onTopic",  ON_TOPIC,  state.onTopic);

    renderChips("diseases", DISEASES, state.diseases);
    renderChips("hospitals", HOSPITALS, state.hospitals);
    renderSegment("gait", GAIT, state.gait);

    $("noDisease").addEventListener("change", e => {
      state.noDisease = e.target.checked;
      if(state.noDisease){ state.diseases.clear(); state.hospitals.clear(); renderChips("diseases", DISEASES, state.diseases); renderChips("hospitals", HOSPITALS, state.hospitals); }
      maybeAuto(1);
    });

    $("useAid").addEventListener("change", e => {
      state.useAid = e.target.checked;
      $("useAidLabel").textContent = state.useAid ? "使用" : "未使用";
      const aidsDiv = $("aids");
      aidsDiv.style.display = state.useAid ? "flex" : "none";
      if(!state.useAid) state.aids.clear();
      renderChips("aids", WALK_AID, state.aids);
      maybeAuto(1);
    });
    renderChips("aids", WALK_AID, state.aids);
    renderSegment("adl", ADL_LEVEL, state.adl);

    renderChips("cohab",   COHAB,   state.cohab);
    renderChips("housing", HOUSING, state.housing);
    renderChips("outdoor", OUTDOOR, state.outdoor);
    renderChips("support", SUPPORT, state.support);

    renderChips("needs", NEEDS, state.needs);
    $("needsNote").addEventListener("input", e=>{ state.needsNote = e.target.value; maybeAuto(2); });

    renderChips("goals", GOALS, state.goals);
    $("goalsNote").addEventListener("input", e=>{ state.goalsNote = e.target.value; maybeAuto(3); });

    renderChips("services", SERVICES, state.services);
    $("serviceSched").addEventListener("input", e=>{ state.serviceSched = e.target.value; maybeAuto(4); });
    $("servicesNote").addEventListener("input", e=>{ state.servicesNote = e.target.value; maybeAuto(4); });

    renderChips("education", EDU_TOPICS, state.education);
    $("educationNote").addEventListener("input", e=>{ state.educationNote = e.target.value; maybeAuto(5); });

    renderSegment("followType", FOLLOW_TYPES, state.followType);
    $("nextDate").addEventListener("input", e=>{ state.nextDate = e.target.value; maybeAuto(6); });
    $("followOwner").addEventListener("input", e=>{ state.followOwner = e.target.value; maybeAuto(6); });
    $("followNote").addEventListener("input", e=>{ state.followNote = e.target.value; maybeAuto(6); });

    /* ===== 段落內容儲存 / 切換編輯 ===== */
    const sections = {1:"",2:"",3:"",4:"",5:"",6:""};      // 使用者看得到的最終文字
    const lastAuto = {1:"",2:"",3:"",4:"",5:"",6:""};      // 系統上次自動生成
    const dirty    = {1:false,2:false,3:false,4:false,5:false,6:false}; // 使用者是否手改過
    let active = 1;

    const editor = $("editor");
    editor.addEventListener("input", ()=>{
      sections[active] = editor.value;
      dirty[active] = true; // 手動編輯後就不覆蓋
    });

    function switchTo(n){
      active = n;
      document.querySelectorAll(".tab").forEach(b=>{
        b.classList.toggle("active", Number(b.dataset.sec)===n);
      });
      editor.value = sections[n] || "";
      editor.placeholder = `正在編輯【第${n}段：${NAMES[n]}】`;
    }
    document.querySelectorAll(".tab").forEach(btn=>{
      btn.addEventListener("click", ()=> switchTo(Number(btn.dataset.sec)));
    });

    $("clearThis").addEventListener("click", ()=>{
      sections[active] = "";
      dirty[active] = false;
      editor.value = "";
    });

    /* ===== 段落產生器 ===== */
    function gen1(){
      const rocDate = toROC(state.visitDate);
      const parties = (state.parties.size? Array.from(state.parties).join("、") : "個案");
      // 第一小段
      let bits = [];
      bits.push(`於${rocDate}訪視${parties}。`);

      bits.push(`意識${state.awareness.value}；`);
      if(state.hearing.size) bits.push(`聽力${chipsToList(state.hearing)}；`);
      bits.push(`認知功能${state.cognition.value}；`);
      bits.push(`${state.onTopic.value}切題對談；`);

      if(state.noDisease){
        bits.push("無疾病史；");
      }else if(state.diseases.size){
        const ds = chipsToList(state.diseases);
        if(state.hospitals.size){
          bits.push(`有${ds}疾病史，規律於${chipsToList(state.hospitals)}追蹤；`);
        }else{
          bits.push(`有${ds}疾病史；`);
        }
      }

      bits.push(`步態${state.gait.value}；`);
      if(state.useAid){
        const aids = state.aids.size? chipsToList(state.aids) : "助行器、拐杖、輪椅";
        bits.push(`行動需使用${aids}；`);
      }else{
        bits.push("行走未使用輔具；");
      }
      if(state.adl.value==="可自理") bits.push("基本日常生活可自理。");
      if(state.adl.value==="部分需協助（如廁/沐浴）") bits.push("基本日常生活部分（如廁/沐浴）需協助。");
      if(state.adl.value==="完全無法自理") bits.push("基本日常生活完全無法自理。");

      const para1 = bits.join(" ").replace(/；\s*。/g,"。");

      // 第二小段：同住/住所/外出/支持
      const lns = [];
      if(state.cohab.size){
        if(state.cohab.has("獨居")){
          lns.push("個案獨居。");
        }else{
          const others = Array.from(state.cohab).filter(x=>x!=="獨居");
          if(others.length) lns.push(`個案與${others.join("、")}同住。`);
        }
      }
      if(state.housing.size) lns.push(`住所類型：${chipsToList(state.housing)}。`);
      if(state.outdoor.size){
        const desc = Array.from(state.outdoor).map(x=>OUTDOOR_MAP[x]).join("、");
        lns.push(`${desc}。`);
      }
      if(state.support.size) lns.push(`照顧支持：${chipsToList(state.support)}。`);

      const para2 = lns.join("\n");

      return [para1.trim(), para2.trim()].filter(Boolean).join("\n\n");
    }

    function gen2(){
      const list = chipsToList(state.needs);
      const note = state.needsNote?.trim();
      const main = list? `主要需求/問題評估：${list}。` : "主要需求/問題評估：—。";
      const extra = note? `\n補充：${note}` : "";
      return `${main}${extra}`.trim();
    }
    function gen3(){
      const list = chipsToList(state.goals);
      const note = state.goalsNote?.trim();
      const main = list? `照護目標：${list}。` : "照護目標：—。";
      const extra = note? `\n量化/補充：${note}` : "";
      return `${main}${extra}`.trim();
    }
    function gen4(){
      const list = chipsToList(state.services);
      const sched = state.serviceSched?.trim();
      const note  = state.servicesNote?.trim();
      const main = list? `服務計畫：${list}。` : "服務計畫：—。";
      const s1 = sched? `\n時程/頻率：${sched}。` : "";
      const s2 = note?  `\n補充：${note}` : "";
      return `${main}${s1}${s2}`.trim();
    }
    function gen5(){
      const list = chipsToList(state.education);
      const note = state.educationNote?.trim();
      const main = list? `風險與衛教：${list}。` : "風險與衛教：—。";
      const extra = note? `\n重點：${note}` : "";
      return `${main}${extra}`.trim();
    }
    function gen6(){
      const dateStr = state.nextDate? toROC(state.nextDate) : "____/__/__";
      const who = state.followOwner?.trim();
      const note = state.followNote?.trim();
      const main = `下次追蹤：${dateStr}，方式：${state.followType.value}${ who? `，負責：${who}`:""}。`;
      const extra = note? `\n備註：${note}` : "";
      return `${main}${extra}`.trim();
    }

    const generators = {1:gen1,2:gen2,3:gen3,4:gen4,5:gen5,6:gen6};

    // 尚未手改過（dirty=false）才自動覆蓋
    function maybeAuto(n){
      const text = generators[n]();
      lastAuto[n] = text;
      if(!dirty[n]){ sections[n] = text; if(active===n) editor.value = text; }
    }

    /* 初次載入先套一次（不輸出任何括號/預設無文字也可） */
    [1,2,3,4,5,6].forEach(maybeAuto);
    switchTo(1);

    /* 複製全部（依左側勾選） */
    $("copyBtn").addEventListener("click", async ()=>{
      const selected = [1,2,3,4,5,6].filter(i=> $("sec"+i).checked);
      const out = selected.map(n=>{
        const body = (sections[n]||"").trim();
        return body? `【第${n}段：${NAMES[n]}】\n${body}` : "";
      }).filter(Boolean).join("\n\n");
      try{
        await navigator.clipboard.writeText(out || "");
        const btn = $("copyBtn"); const old = btn.textContent;
        btn.textContent = "已複製"; setTimeout(()=>btn.textContent = old, 1200);
      }catch{ alert("無法複製，請手動選取文字。"); }
    });
  </script>
</body>
</html>
